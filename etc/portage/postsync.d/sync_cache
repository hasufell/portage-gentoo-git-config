#!/bin/bash

source /etc/portage/check-portdir.sh
source /etc/init.d/functions.sh
source /etc/portage/util-functions.sh

ebegin "Fetching server-generated metadata cache"
rsync -aq rsync://rsync.gentoo.org/gentoo-portage/metadata/md5-cache/ "${PORTDIR}"/metadata/md5-cache/
eend $?

for repo in $(portageq get_repos /); do
	ebegin "Updating metadata cache for ${repo} repository"
	egencache --jobs=$(nproc) --repo=${repo} --update --update-use-local-desc
	eend $?
done
